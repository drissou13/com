<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Communication Régie / Présentateur</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
  }
  #loginBox, #regieBox, #speakerBox {
    max-width: 400px;
    margin: auto;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type=text], input[type=password], textarea {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
  }
  button {
    margin-top: 15px;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
  }
  #messages {
    border: 1px solid #ccc;
    background: #f9f9f9;
    min-height: 120px;
    padding: 15px;
    border-radius: 5px;
  }
  .message {
    background-color: #e1f5fe;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
  }
  #logoutBtn {
    margin-top: 20px;
    background: #f44336;
    color: white;
    border: none;
  }
</style>
</head>
<body>

<div id="loginBox">
  <h2>Connexion</h2>
  <label for="username">Utilisateur</label>
  <input type="text" id="username" placeholder="regie ou speaker" autocomplete="off" />
  
  <label for="password">Mot de passe</label>
  <input type="password" id="password" placeholder="Mot de passe" autocomplete="off" />
  
  <button id="loginBtn">Se connecter</button>
  <p id="loginError" style="color: red;"></p>
</div>

<div id="regieBox" style="display:none;">
  <h2>Interface Régie</h2>
  <textarea id="messageInput" placeholder="Tapez un message pour le présentateur..."></textarea>
  <button id="sendBtn">Envoyer</button>
  <button id="logoutBtnRegie">Se déconnecter</button>
</div>

<div id="speakerBox" style="display:none;">
  <h2>Interface Présentateur</h2>
  <div id="messages">Aucun message pour l'instant.</div>
  <button id="logoutBtnSpeaker">Se déconnecter</button>
</div>

<script>
  // Comptes définis
  const users = {
    regie: "festipyat",
    speaker: "speaker"
  };

  const loginBox = document.getElementById('loginBox');
  const regieBox = document.getElementById('regieBox');
  const speakerBox = document.getElementById('speakerBox');
  const loginError = document.getElementById('loginError');

  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');

  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');

  const messagesDiv = document.getElementById('messages');

  const logoutBtnRegie = document.getElementById('logoutBtnRegie');
  const logoutBtnSpeaker = document.getElementById('logoutBtnSpeaker');

  // Stockage session (simple) dans localStorage
  function setSession(user) {
    localStorage.setItem('currentUser', user);
  }
  function getSession() {
    return localStorage.getItem('currentUser');
  }
  function clearSession() {
    localStorage.removeItem('currentUser');
  }

  // Affiche les bonnes sections selon l'utilisateur connecté
  function showInterface(user) {
    loginBox.style.display = 'none';
    if(user === 'regie') {
      regieBox.style.display = 'block';
      speakerBox.style.display = 'none';
    } else if(user === 'speaker') {
      speakerBox.style.display = 'block';
      regieBox.style.display = 'none';
      startCheckingMessages();
    }
  }

  // Login
  loginBtn.addEventListener('click', () => {
    const user = usernameInput.value.trim().toLowerCase();
    const pass = passwordInput.value;

    if(users[user] && users[user] === pass) {
      setSession(user);
      loginError.textContent = '';
      showInterface(user);
    } else {
      loginError.textContent = 'Identifiant ou mot de passe incorrect.';
    }
  });

  // Envoi message régie
  sendBtn.addEventListener('click', () => {
    const msg = messageInput.value.trim();
    if(msg === '') {
      alert('Veuillez saisir un message');
      return;
    }
    const data = {
      message: msg,
      timestamp: Date.now()
    };
    localStorage.setItem('messageToPresenter', JSON.stringify(data));
    alert('Message envoyé !');
    messageInput.value = '';
  });

  // Vérification messages pour le présentateur
  let lastTimestamp = 0;
  let intervalId = null;

  function checkMessages() {
    const dataStr = localStorage.getItem('messageToPresenter');
    if(!dataStr) return;
    const data = JSON.parse(dataStr);
    if(data.timestamp > lastTimestamp) {
      lastTimestamp = data.timestamp;
      messagesDiv.innerHTML = '';
      const msgEl = document.createElement('div');
      msgEl.className = 'message';
      msgEl.textContent = data.message;
      messagesDiv.appendChild(msgEl);
    }
  }

  function startCheckingMessages() {
    checkMessages(); // premier check
    intervalId = setInterval(checkMessages, 1500);
  }

  function stopCheckingMessages() {
    if(intervalId) {
      clearInterval(intervalId);
      intervalId = null;
    }
  }

  // Déconnexion
  logoutBtnRegie.addEventListener('click', () => {
    clearSession();
    regieBox.style.display = 'none';
    loginBox.style.display = 'block';
  });
  logoutBtnSpeaker.addEventListener('click', () => {
    clearSession();
    stopCheckingMessages();
    speakerBox.style.display = 'none';
    loginBox.style.display = 'block';
  });

  // Si déjà connecté à l'ouverture de la page
  const currentUser = getSession();
  if(currentUser) {
    showInterface(currentUser);
  }
</script>

</body>
</html>
